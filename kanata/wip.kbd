#|
ULTIMATE VIM-STYLE KANATA CONFIG FOR LOFREE FLOW LITE 84
- Caps Lock: tap=Esc, hold=Ctrl
- Esc: tap=Esc, double-tap=live reload
- Space: tap=Space, hold=Win
- Enter: tap=Enter, hold=Alt
- Right Alt: tap=Alt, double-tap=fcitx5 next input method
- Vim mode: hjkl, w/b/e, d/c/v operators, visual mode
- French Unicode: Ã©, Ã , Ã§, Â« Â», Å“, â‚¬
- Only intercepts Lofree Flow Lite (2.4GHz)
|#

(defcfg
  ;; Only your Lofree Flow Lite
  linux-dev /dev/input/by-id/usb-CX_2.4G_Wireless_Receiver-event-kbd

  ;; Enable unmapped keys for tap-hold logic
  process-unmapped-keys yes

  ;; Smoother tap-hold
  concurrent-tap-hold yes

  ;; Enable fcitx5 and cmd
  danger-enable-cmd yes
)

;; â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
;; â”‚ Physical Layout: Lofree Flow Lite 84         â”‚
;; â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(defsrc
  esc  f1   f2   f3   f4   f5   f6   f7   f8   f9   f10  f11  f12  prnt ins del
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc      home
  tab  q    w    e    r    t    y    u    i    o    p    [    ]    \        end
  caps a    s    d    f    g    h    j    k    l    ;    '    ret          pgup
  lsft z    x    c    v    b    n    m    ,    .    /    rsft up            pgdn
  lctl lalt lmet           spc            rmet ralt left down right
)

;; â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
;; â”‚ Reusable Aliases                             â”‚
;; â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(defalias
  ;; â”€â”€ Esc: tap=Esc, double=reload â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  esc-reload (tap-dance 250 (esc lrld))

  ;; â”€â”€ Caps Lock: tap=Esc, hold=Ctrl â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  caps-ctrl (tap-hold 200 200 esc lctl)

  ;; â”€â”€ Space: tap=Space, hold=Win â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  space-win (tap-hold 200 200 spc lmet)

  ;; â”€â”€ Enter: tap=Enter, hold=Alt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  enter-alt (tap-hold 200 200 ret lalt)

  ;; â”€â”€ Right Alt: tap=Alt, double=fcitx5 next â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  fcitx-next (cmd sh -c "fcitx5-remote -n")
  ralt-im (tap-dance 250 (ralt @fcitx-next))

  ;; â”€â”€ French Unicode â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Ã© (unicode Ã©)
  Ã¨ (unicode Ã¨)
  Ã  (unicode Ã )
  Ã¹ (unicode Ã¹)
  Ã§ (unicode Ã§)
  Â« (unicode Â«)
  Â» (unicode Â»)
  Å“ (unicode Å“)
  â‚¬ (unicode â‚¬)
)

;; â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
;; â”‚ Base Layer                                   â”‚
;; â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(deflayer base
  @esc-reload f1   f2   f3   f4   f5   f6   f7   f8   f9   f10  f11  f12  prnt ins del
  grv         1    2    3    4    5    6    7    8    9    0    -    =    bspc      home
  tab         q    w    e    r    t    y    u    i    o    p    [    ]    \        end
  @caps-ctrl  a    s    d    f    g    h    j    k    l    ;    '    @enter-alt   pgup
  lsft        z    x    c    v    b    n    m    ,    .    /    rsft up            pgdn
  lctl        lalt lmet           @space-win     rmet @ralt-im left down right
)

;; â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
;; â”‚ Vim Mode Layer                               â”‚
;; â”‚ Activated by: Shift+Shift+H                  â”‚
;; â”‚ Esc = return to base                         â”‚
;; â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(deflayer vim
  (layer-switch base)  ; Esc = return to base
  _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
  _ _ _ _ _ _ _ _ _ _ _ _ _ _      home
  _ _ _ _ _ _ _ _ up _ _ _ _        end
  _ _ @vim-w @vim-b @vim-e _ home left down rght end _ _             pgup
  _ _ _ _ _ _ _ _ _ _ _ _ up       pgdn
  _ _ _           _           _ _ left down right
)

;; â”€â”€ Vim Motions (as macros using standard shortcuts) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(defalias
  vim-h (macro left)
  vim-j (macro down)
  vim-k (macro up)
  vim-l (macro right)
  vim-w (macro C-right)     ; next word
  vim-b (macro C-left)      ; prev word
  vim-e (macro C-right)     ; end of word
)

;; â”€â”€ Operator-Pending Layers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(deflayer vim-del
  (layer-switch base)
  _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
  _ _ _ _ _ _ _ _ _ _ _ _ _ _      _
  _ _ _ _ _ _ _ _ @d-k _ _ _ _      _
  _ _ @d-w @d-b @d-e _ @d-0 @d-h @d-j @d-l @d-$ _ _
  _ _ _ _ _ _ _ _ _ _ _ _ _        _
  _ _ _           _           _ _ _ _ _
)

(deflayer vim-chg
  (layer-switch base)
  _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
  _ _ _ _ _ _ _ _ _ _ _ _ _ _      _
  _ _ _ _ _ _ _ _ @c-k _ _ _ _      _
  _ _ @c-w @c-b @c-e _ @c-0 @c-h @c-j @c-l @c-$ _ _
  _ _ _ _ _ _ _ _ _ _ _ _ _        _
  _ _ _           _           _ _ _ _ _
)

(deflayer vim-vis
  (layer-switch base)
  _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
  _ _ _ _ _ _ _ _ _ _ _ _ _ _      _
  _ _ _ _ _ _ _ _ @v-k _ _ _ _      _
  _ _ @v-w @v-b @v-e _ @v-0 @v-h @v-j @v-l @v-$ _ _
  _ _ _ _ _ _ _ _ _ _ _ _ _        _
  _ _ _           _           _ _ _ _ _
)

;; â”€â”€ Operator Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(defalias
  ;; Delete motions
  d-h (macro S-left del)
  d-j (macro S-down del)
  d-k (macro S-up del)
  d-l (macro S-right del)
  d-w (macro C-S-right del)
  d-b (macro C-S-left del)
  d-e (macro C-S-right del)
  d-0 (macro S-home del)
  d-$ (macro S-end del)

  ;; Change = delete + stay in insert (no extra action needed)
  c-h @d-h
  c-j @d-j
  c-k @d-k
  c-l @d-l
  c-w @d-w
  c-b @d-b
  c-e @d-e
  c-0 @d-0
  c-$ @d-$

  ;; Visual = shift + motion
  v-h (macro lsft left)
  v-j (macro lsft down)
  v-k (macro lsft up)
  v-l (macro lsft right)
  v-w (macro lsft C-right)
  v-b (macro lsft C-left)
  v-e (macro lsft C-right)
  v-0 (macro lsft home)
  v-$ (macro lsft end)
)

;; â”€â”€ Vim Operator Keys â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(defalias
  vim-d (layer-switch vim-del)
  vim-c (layer-switch vim-chg)
  vim-v (layer-switch vim-vis)
)

;; â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
;; â”‚ Symbols Layer (French/Unicode)               â”‚
;; â”‚ Activated by: Shift+Shift+S                  â”‚
;; â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(deflayer sym
  _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
  grv ! @ @ # $ % ^ & * ( ) _ + bspc      _
  ~   @Ã© @Ã¨ @Ã  @Ã¹ _ _ @Ã§ _ _ @Â« @Â» | \     _
  _   _ _ _ _ _ _ _ _ _ _ _ _             _
  _   _ _ _ _ _ _ _ _ _ _ _ _             _
  _   _ _           _           _ _ _ _ _
)

;; â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
;; â”‚ Global Chords: Shift+Shift+Key               â”‚
;; â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(defchordsv2
  (lsft rsft h) (layer-while-held vim)  200 first-release ()
  (lsft rsft s) (layer-while-held sym)  200 first-release ()
)

#|
ğŸ’¡ USAGE:

- **Vim Mode**:
    - Hold `Left Shift + Right Shift + H` â†’ Vim mode
    - `hjkl` = arrows, `w/b/e` = word nav
    - `d` â†’ delete mode â†’ `w` = delete word
    - `c` â†’ change mode â†’ `e` = change to end of word
    - `v` â†’ visual mode â†’ `j` = select down
    - `Esc` â†’ return to base

- **Live Reload**: Double-tap `Esc`

- **Input Switch**: Double-tap `Right Alt`

- **Space**: Hold = Win, Tap = Space

- **Enter**: Hold = Alt, Tap = Enter

- **Symbols**: Hold `Shift+Shift+S` â†’ `Ã©`, `Ã§`, `Â« Â», etc.

|#
