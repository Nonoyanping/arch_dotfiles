# ================================================
# TMUX KEYBINDINGS - ENHANCED
# ================================================

# ===== PREFIX =====
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# ===== RELOAD CONFIG =====
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display "Û∞ëì Config Reloaded!"

# ===== PANE MANAGEMENT =====
# Split panes (open in current path)
unbind '"'
unbind %
bind - split-window -v -c "#{pane_current_path}"
bind \\ split-window -h -c "#{pane_current_path}"
bind % split-window -c "#{pane_current_path}" -h
bind '"' split-window -c "#{pane_current_path}"

# Kill pane without confirmation
bind x kill-pane

# Kill window
bind X kill-window

# Zoom pane
bind m resize-pane -Z

# Break pane into new window
bind B break-pane

# Join pane from another window
bind J choose-window 'join-pane -h -s "%%"'

# ===== NAVIGATION =====
# Vim-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# NOTE: Maybe leave C-o for Nvim
bind o select-pane -t :.+

# Window navigation
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# Create new window in current path
# NOTE: how about using n?
bind c new-window -c "#{pane_current_path}"
# bind -n M-O next-window 
# bind -n M-I previous-window

# ===== SESSION MANAGEMENT =====
# Switch between sessions
bind -r ( switch-client -p
bind -r ) switch-client -n

# Create new session
bind C-c new-session

# Find session
bind C-f command-prompt -p find-session 'switch-client -t %%'

# Sesh last session
bind L run-shell "sesh last || tmux display-message -d 1000 'Only one session'"

# Connect to root session
bind 9 run-shell "sesh connect --root '$(pwd)'"

# Kill current session
bind Q kill-session

# ===== ENHANCED SESH INTEGRATION =====
# Main sesh interface (Ctrl-a + K) - Full featured with better styling
bind K run-shell "sesh connect \"$(
  sesh list --icons --hide-duplicates | fzf-tmux -p 100%,100% --no-border \
    --list-border \
    --no-sort --prompt '‚ö°  ' \
    --input-border \
    --header-border \
    --bind 'tab:down,btab:up' \
    --bind 'ctrl-b:abort' \
    --bind 'ctrl-a:change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --bind 'ctrl-t:change-prompt(ü™ü  )+reload(sesh list -t --icons)' \
    --bind 'ctrl-g:change-prompt(‚öôÔ∏è  )+reload(sesh list -c --icons)' \
    --bind 'ctrl-x:change-prompt(üìÅ  )+reload(sesh list -z --icons)' \
    --bind 'ctrl-f:change-prompt(üîé  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
    --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --preview-window 'right:70%' \
    --preview 'sesh preview {}'
)\""

# Root sessions filter (Ctrl-a + R)
bind R run-shell "sesh connect \"$(
  sesh list --icons | fzf-tmux -p 100%,100% --no-border \
    --query \"$(sesh root)\" \
    --list-border \
    --no-sort --prompt '‚ö°  ' \
    --input-border \
    --bind 'tab:down,btab:up' \
    --bind 'ctrl-b:abort' \
    --bind 'ctrl-t:change-prompt(ü™ü  )+reload(sesh list -t --icons)' \
    --bind 'ctrl-g:change-prompt(‚öôÔ∏è  )+reload(sesh list -c --icons)' \
    --bind 'ctrl-x:change-prompt(üìÅ  )+reload(sesh list -z --icons)' \
    --bind 'ctrl-f:change-prompt(üîé  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
    --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --preview-window 'right:70%' \
    --preview 'sesh preview {}'
)\""

# Quick session switcher (Ctrl-a + s)
bind s display-popup -E -w 80% -h 80% "sesh connect \"$(
  sesh list -t -c --icons | fzf-tmux -p 100%,100% --no-border \
    --list-border \
    --no-sort --prompt '‚ö°  ' \
    --input-border \
    --bind 'ctrl-d:execute(tmux kill-session -t {2..})+reload(sesh list -t -c --icons)' \
    --preview-window 'right:70%' \
    --preview 'sesh preview {}'
)\""

# ===== WORKFLOW SHORTCUTS =====
# Lazygit
bind g new-window -S -n 'üå≥' 'lazygit'

# Editor (Neovim)
bind E new-window -S -n 'üìù' 'nvim'

# GitHub CLI Dashboard (if installed)
bind G new-window -c "#{pane_current_path}" -n "üò∫" "gh dash 2> /dev/null"

# Lazydocker (if installed)
bind d new-window -S -n 'üê≥' 'lazydocker'

# File manager (yazi)
bind y new-window -S -n 'üìÅ' 'yazi'

# Run npm script (if package.json exists)
bind Y split-window -v -l 10 "npm run \$(jq -r '.scripts | keys[]' package.json | fzf --no-border)"

# NOTE: Something Interesting

# Session management
# bind-key -r f run-shell "tmux neww ~/scripts/tmux-sessionizer"
# bind-key n command-prompt "new-session -s '%%'"

# Popup tools
# bind-key C-y display-popup -d "#{pane_current_path}" -w 90% -h 90% -E "yazi"
# bind-key C-t display-popup -d "#{pane_current_path}" -w 80% -h 80% -E "zsh"
# bind-key C-g display-popup -d "#{pane_current_path}" -w 90% -h 90% -E "lazygit"
# bind-key C-m display-popup -w 95% -h 95% -E "rmpc"
# bind-key -n C-p send-keys 'pj' Enter

# ===== COPY MODE (VI) =====
setw -g mode-keys vi

# Copy mode bindings
unbind v
bind v copy-mode
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi C-v send -X rectangle-toggle
# bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi Escape send -X cancel

# Copy mode navigation (vim-style)
bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R

# Enter/exit copy mode
bind [ copy-mode
bind ] paste-buffer

# Open current pane content in editor
bind e send-keys "tmux capture-pane -p -S - | nvim -c 'set buftype=nofile' +" Enter# INFO: How about ` as prefix

# Calypso Navigator ‚Äî C-f anywhere (tmux popup)
# bind -T root C-e run-shell "tmux display-popup -E -w 90% -h 60% -xC -yC 'calypso search'"
# bind -T copy-mode C-e run-shell "tmux display-popup -E -w 90% -h 60% -xC -yC 'calypso search'"
bind-key C-e run-shell "calypso search ''"
